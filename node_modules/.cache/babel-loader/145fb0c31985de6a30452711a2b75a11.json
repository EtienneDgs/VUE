{"remainingRequest":"/home/clement/twp/mvvm_twp/node_modules/babel-loader/lib/index.js!/home/clement/twp/mvvm_twp/node_modules/eslint-loader/index.js??ref--13-0!/home/clement/twp/mvvm_twp/src/store/auth.js","dependencies":[{"path":"/home/clement/twp/mvvm_twp/src/store/auth.js","mtime":1607029193367},{"path":"/home/clement/twp/mvvm_twp/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/clement/twp/mvvm_twp/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/clement/twp/mvvm_twp/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiL2hvbWUvY2xlbWVudC90d3AvbXZ2bV90d3Avbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZXNwYWNlZDogdHJ1ZSwKICBzdGF0ZTogewogICAgdG9rZW46IG51bGwsCiAgICB1c2VyOiBudWxsCiAgfSwKICBnZXR0ZXJzOiB7CiAgICBhdXRoZW50aWNhdGVkOiBmdW5jdGlvbiBhdXRoZW50aWNhdGVkKHN0YXRlKSB7CiAgICAgIC8vIHJldG91cm4gdHJ1ZSBzaSBpbCB5IGEgdW4gdG9rZW4gKyB1c2VyIGRhbnMgbGUgc3RhdGUsIGZhbHNlIHNpbm9uCiAgICAgIC8vdmFyIGVzdCA9IGZhbHNlOwogICAgICBpZiAoc3RhdGUudG9rZW4gJiYgc3RhdGUudXNlcikgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIHVzZXI6IGZ1bmN0aW9uIHVzZXIoc3RhdGUpIHsKICAgICAgLy9yZXRvdXJuZSBsJ3V0aWxpc2F0dWVyCiAgICAgIHJldHVybiBzdGF0ZS51c2VyOwogICAgfQogIH0sCiAgbXV0YXRpb25zOiB7CiAgICBTRVRfVE9LRU46IGZ1bmN0aW9uIFNFVF9UT0tFTihzdGF0ZSwgdG9rZW4pIHsKICAgICAgc3RhdGUudG9rZW4gPSB0b2tlbjsKICAgIH0sCiAgICBTRVRfVVNFUjogZnVuY3Rpb24gU0VUX1VTRVIoc3RhdGUsIHVzZXIpIHsKICAgICAgc3RhdGUudXNlciA9IHVzZXI7CiAgICB9CiAgfSwKICBhY3Rpb25zOiB7CiAgICBzaWduaW46IGZ1bmN0aW9uIHNpZ25pbihfcmVmLCBjcmVkZW50aWFscykgewogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKCkgewogICAgICAgIHZhciBkaXNwYXRjaCwgcmVzOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGRpc3BhdGNoID0gX3JlZi5kaXNwYXRjaDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIGF4aW9zLnBvc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMC9hcGkvYXV0aC9zaWduaW4nLCB7CiAgICAgICAgICAgICAgICAgIC8vdsOpcmlmaWUgc2kgbWFpbCBldCBtZHAgc29udCBsZXMgYm9ucwogICAgICAgICAgICAgICAgICAnZW1haWwnOiBjcmVkZW50aWFsc1swXSwKICAgICAgICAgICAgICAgICAgJ3Bhc3N3b3JkJzogY3JlZGVudGlhbHNbMV0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXMgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgZGlzcGF0Y2goJ2F0dGVtcHQnLCByZXMuZGF0YS50b2tlbikpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgYXR0ZW1wdDogZnVuY3Rpb24gYXR0ZW1wdChfcmVmMiwgdG9rZW4pIHsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIGNvbW1pdCwgc3RhdGUsIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb21taXQgPSBfcmVmMi5jb21taXQsIHN0YXRlID0gX3JlZjIuc3RhdGU7CgogICAgICAgICAgICAgICAgLy9vbiByw6ljdXDDqHJlIGxhIHLDqXBvbnNlIGR1IHNpZ25pbiAobGUgdG9rZW4sIG91IHJpZW4gZHUgdG91dCkKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2codG9rZW4pOwogICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7CiAgICAgICAgICAgICAgICAgIGNvbW1pdCgnU0VUX1RPS0VOJywgdG9rZW4pOyAvLyBvbiBjaGFuZ2UgbGUgc3RhdGUgZW4gYWpvdXRhbnQgbGUgdG9rZW4KICAgICAgICAgICAgICAgICAgLy9vbiBham91dGUgbGUgdG9rZW4gYXUgaGVhZGVyIGRhbnMgbGUgc3Vic2NyaWJlci5qcyBwZHQgbGUgY29tbWl0IFNFVF9UT0tFTiBjYXIgb24gIsOpY291dGUiIGxhIG11dGF0aW9uIGR1IGNvbW1pdAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0ZS50b2tlbikgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSA0OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIGF4aW9zLmdldCgnaHR0cDovL2xvY2FsaG9zdDo4MDAwL2FwaS9hdXRoL21lJyAvL29uIHRlc3RlIHNpIGxlIHRva2VuIGVzdCB2YWxpZGUKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQyLnNlbnQ7CiAgICAgICAgICAgICAgICBjb21taXQoJ1NFVF9VU0VSJywgcmVzcG9uc2UuZGF0YSk7IC8vc2kgb3VpLCBvbiBzZXQgbGUgc3RhdGUgYXZlYyBsZXMgdXNlcnMgKHLDqXBvbnNlIGR1IGF1dGgvbWUpCgogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSAxNjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgX2NvbnRleHQyLnByZXYgPSAxMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi50MCA9IF9jb250ZXh0MlsiY2F0Y2giXSg0KTsKICAgICAgICAgICAgICAgIC8vIHRva2VuIG5vbiB2YWxpZGUgPT4gb24gc3VwcHJpbWUgbGVzIGluZm9zIHN0b2Nrw6llcyBkYW5zIFZVRSwgcGFyIG51bGwKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmYWlsZWQgZ2V0IG1lIEFQSSByZXF1ZXN0IDopICcpOwogICAgICAgICAgICAgICAgY29tbWl0KCdTRVRfVE9LRU4nLCBudWxsKTsKICAgICAgICAgICAgICAgIGNvbW1pdCgnU0VUX1VTRVInLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgbnVsbCwgW1s0LCAxMV1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgc2lnbm91dDogZnVuY3Rpb24gc2lnbm91dChfcmVmMykgewogICAgICB2YXIgY29tbWl0ID0gX3JlZjMuY29tbWl0OwogICAgICByZXR1cm4gYXhpb3MucG9zdCgnaHR0cDovL2xvY2FsaG9zdDo4MDAwL2FwaS9hdXRoL3NpZ25vdXQnKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBjb21taXQoJ1NFVF9UT0tFTicsIG51bGwpOwogICAgICAgIGNvbW1pdCgnU0VUX1VTRVInLCBudWxsKTsKICAgICAgfSk7CiAgICB9CiAgfQp9Ow=="},{"version":3,"sources":["/home/clement/twp/mvvm_twp/src/store/auth.js"],"names":["axios","namespaced","state","token","user","getters","authenticated","mutations","SET_TOKEN","SET_USER","actions","signin","credentials","dispatch","post","res","data","attempt","commit","get","response","console","log","signout","then"],"mappings":";;AACA,OAAOA,KAAP,MAAkB,OAAlB;AAGA,eAAe;AACXC,EAAAA,UAAU,EAAE,IADD;AAGXC,EAAAA,KAAK,EAAE;AACHC,IAAAA,KAAK,EAAE,IADJ;AAEHC,IAAAA,IAAI,EAAE;AAFH,GAHI;AAQXC,EAAAA,OAAO,EAAE;AACLC,IAAAA,aADK,yBACSJ,KADT,EACgB;AAAE;AACnB;AACA,UAAIA,KAAK,CAACC,KAAN,IAAeD,KAAK,CAACE,IAAzB,EAA+B;AAC5B,eAAO,IAAP;AACF,OAFD,MAEO;AACH,eAAO,KAAP;AACH;AACJ,KARI;AAULA,IAAAA,IAVK,gBAUAF,KAVA,EAUO;AAAE;AACV,aAAOA,KAAK,CAACE,IAAb;AACH;AAZI,GARE;AAuBXG,EAAAA,SAAS,EAAE;AACPC,IAAAA,SADO,qBACGN,KADH,EACUC,KADV,EACiB;AACpBD,MAAAA,KAAK,CAACC,KAAN,GAAcA,KAAd;AACH,KAHM;AAIPM,IAAAA,QAJO,oBAIEP,KAJF,EAISE,IAJT,EAIe;AAClBF,MAAAA,KAAK,CAACE,IAAN,GAAaA,IAAb;AACH;AANM,GAvBA;AAgCXM,EAAAA,OAAO,EAAE;AACCC,IAAAA,MADD,wBACwBC,WADxB,EACsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA3BC,gBAAAA,QAA2B,QAA3BA,QAA2B;AAAA;AAAA,uBAEvBb,KAAK,CAACc,IAAN,CAAW,uCAAX,EAAoD;AAAE;AAClE,2BAASF,WAAW,CAAC,CAAD,CAD4C;AAEhE,8BAAYA,WAAW,CAAC,CAAD;AAFyC,iBAApD,CAFuB;;AAAA;AAEnCG,gBAAAA,GAFmC;AAAA,iDAOhCF,QAAQ,CAAC,SAAD,EAAYE,GAAG,CAACC,IAAJ,CAASb,KAArB,CAPwB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQ1C,KATI;AAWCc,IAAAA,OAXD,0BAW6Bd,KAX7B,EAWoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAxBe,gBAAAA,MAAwB,SAAxBA,MAAwB,EAAhBhB,KAAgB,SAAhBA,KAAgB;;AAAE;AACvC;AACA,oBAAIC,KAAJ,EAAW;AACPe,kBAAAA,MAAM,CAAC,WAAD,EAAcf,KAAd,CAAN,CADO,CACqB;AAC5B;AACH;;AALoC,oBAMjCD,KAAK,CAACC,KAN2B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA,uBAWZH,KAAK,CAACmB,GAAN,CAAU,mCAAV,CAA8C;AAA9C,iBAXY;;AAAA;AAW7BC,gBAAAA,QAX6B;AAcjCF,gBAAAA,MAAM,CAAC,UAAD,EAAaE,QAAQ,CAACJ,IAAtB,CAAN,CAdiC,CAcE;;AAdF;AAAA;;AAAA;AAAA;AAAA;AAgBvB;AACVK,gBAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ;AACAJ,gBAAAA,MAAM,CAAC,WAAD,EAAc,IAAd,CAAN;AACAA,gBAAAA,MAAM,CAAC,UAAD,EAAa,IAAb,CAAN;;AAnBiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBxC,KAhCI;AAkCLK,IAAAA,OAlCK,0BAkCiB;AAAA,UAAXL,MAAW,SAAXA,MAAW;AAClB,aAAOlB,KAAK,CAACc,IAAN,CAAW,wCAAX,EAAqDU,IAArD,CAA0D,YAAM;AACnEN,QAAAA,MAAM,CAAC,WAAD,EAAc,IAAd,CAAN;AACAA,QAAAA,MAAM,CAAC,UAAD,EAAa,IAAb,CAAN;AACH,OAHM,CAAP;AAIH;AAvCI;AAhCE,CAAf","sourcesContent":["\nimport axios from 'axios';\n\n\nexport default {\n    namespaced: true,\n\n    state: {\n        token: null,\n        user: null\n    },\n\n    getters: {\n        authenticated(state) { // retourn true si il y a un token + user dans le state, false sinon\n            //var est = false;\n            if (state.token && state.user) {\n               return true;\n            } else {\n                return false;\n            }\n        },\n\n        user(state) { //retourne l'utilisatuer\n            return state.user;\n        }\n    },\n\n    mutations: {\n        SET_TOKEN(state, token) { \n            state.token = token;\n        },\n        SET_USER(state, user) {\n            state.user = user;\n        }\n    },\n\n    actions: {\n        async signin( { dispatch } , credentials ) { // on appelle la method signin, avec email et mdp\n            \n            let res = await axios.post('http://localhost:8000/api/auth/signin', { //vérifie si mail et mdp sont les bons\n                'email': credentials[0],\n                'password': credentials[1]\n            });\n            //console.log(res.data);\n            return dispatch('attempt', res.data.token); //en envoie le token de la réponse dans la methode attempt\n        },\n\n        async attempt( { commit, state }, token) { //on récupère la réponse du signin (le token, ou rien du tout)\n            //console.log(token);\n            if (token) {\n                commit('SET_TOKEN', token); // on change le state en ajoutant le token\n                //on ajoute le token au header dans le subscriber.js pdt le commit SET_TOKEN car on \"écoute\" la mutation du commit\n            }\n            if(!state.token) {\n                return\n            }\n\n            try {\n                let response = await axios.get('http://localhost:8000/api/auth/me' //on teste si le token est valide\n                   \n                );\n                commit('SET_USER', response.data); //si oui, on set le state avec les users (réponse du auth/me)\n            }\n            catch (err) { // token non valide => on supprime les infos stockées dans VUE, par null\n                console.log('failed get me API request :) ');\n                commit('SET_TOKEN', null);\n                commit('SET_USER', null);\n            }\n        },\n\n        signout( { commit } ) {\n            return axios.post('http://localhost:8000/api/auth/signout').then(() => {\n                commit('SET_TOKEN', null);\n                commit('SET_USER', null);\n            })\n        }\n    }\n}"]}]}